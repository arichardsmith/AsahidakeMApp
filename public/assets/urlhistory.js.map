{"version":3,"file":"urlhistory.js","sources":["../../js/nav/loading.js","../../js/nav/map-control.js","../../js/urlhistory.js"],"sourcesContent":["import $ from 'jquery';\n\n/**\n * Load content from url and insert it into target element.\n * @param {string} target - Element selector\n * @param {string} url - Url to load\n */\nexport function loadURL(selector, url) {\n  const timer = setTimeout(loaderStart, 100); // Wait incase of quick load\n\n  return new Promise((resolve, reject) => {\n    $(selector).load(url, (_, status, xhr) => {\n      clearTimeout(timer);\n      if (status === 'error') {\n        const errMsg = xhr.statusText;\n        loaderError(errMsg);\n        reject(new Error(errMsg));\n      } else {\n        loaderFinish();\n        resolve();\n      }\n    });\n  });\n}\n\nconst loaderElement = document.getElementById('loader');\nconst loaderBox = loaderElement.querySelector('.message');\nconst loaderMessage = loaderElement.querySelector('.message-text');\nconst loaderProgress = loaderElement.querySelector('progress');\n\nfunction updateLoader(newState, msg) {\n  console.log(`${newState} - ${msg}`);\n  switch (newState) {\n    case 'loading':\n      loaderMessage.innerText = '読み込み中';\n      loaderProgress.style.display = 'block';\n      loaderBox.classList.remove('is-danger');\n      loaderElement.classList.add('visible');\n      break;\n    case 'error':\n      loaderMessage.innerHTML = `読み込みエラー<br />${msg}`;\n      loaderProgress.style.display = 'none';\n      loaderBox.classList.add('is-danger');\n      loaderElement.classList.add('visible');\n      break;\n    default:\n      // Hide\n      loaderElement.classList.remove('visible');\n  }\n}\n\nexport function loaderStart() {\n  updateLoader('loading');\n}\n\nexport function loaderFinish() {\n  updateLoader();\n}\n\nexport function loaderError(message) {\n  updateLoader('error', message);\n}\n","/**\n * この関数はAsahidakeMapのwrapperで、\n * マップのスクリプトロード済まない場合、cacheするためのもの\n */\n\nlet hasLoaded = false;\nlet deferedFit = null;\n/**\n * Viewの範囲変化\n *\n * @param {string|Array<number>} extent - 登山道のstring又はnumberのarray\n */\nexport function fitView(view) {\n  if (hasLoaded) {\n    return AsahidakeMap.fitView(view);\n  }\n\n  deferedFit = view;\n}\n\nlet deferedHighlight = null;\n/**\n * 登山道ハイライト\n * 現在ハイライトできる登山道は：（./extents.jsによる}\n * sugatami, summit, nakadake, loop, tennyoga, nakadake\n *\n * @param {string} trail - 登山道の名前 (romajiで)\n */\nexport function highlightTrail(trail) {\n  if (hasLoaded) {\n    return AsahidakeMap.highlightTrail(trail);\n  }\n\n  deferedHighlight = trail;\n}\n\nexport async function getMap() {\n  const map = await loadMap();\n  return map;\n}\n\nfunction loadMap() {\n  return new Promise((resolve, reject) => {\n    if (window.AsahidakeMap !== undefined) {\n      return resolve(window.AsahidakeMap);\n    }\n\n    const scriptElement = document.getElementById('map-script');\n    scriptElement.addEventListener('load', () => {\n      if (window.AsahidakeMap !== undefined) {\n        hasLoaded = true;\n        resolve(window.AsahidakeMap);\n      } else {\n        reject(new Error('Error loading map script'));\n      }\n    });\n  });\n}\n\nloadMap();\n","import { loadURL } from './nav/loading.js';\nimport { fitView, highlightTrail } from './nav/map-control.js';\n/**\n * ナビの処理\n * いつも同じようにナビするため、必ずこの関数を使って\n * @param {string} target - 次のページ\n */\nexport async function doNav(target) {\n  // マップ更新はload後ため、loadURLはawait\n  switch (target) {\n    case 'aboutDaisetsuzan':\n      await loadURL('#column', 'aboutDaisetsuzan.html');\n      fitView('loop');\n      highlightTrail(null);\n      break;\n    case 'aboutTrailToPeak':\n      await loadURL('#column', 'aboutTrailToPeak.html');\n      fitView('summit');\n      highlightTrail('summit');\n      break;\n    case 'about6hLoop':\n      await loadURL('#column', 'about6hLoop.html');\n      fitView('loop');\n      highlightTrail('loop');\n      break;\n    case 'info':\n      await loadURL('#column', 'info.html');\n      highlightTrail(null);\n      break;\n    case 'aboutDaisetsuzanGrade':\n      await loadURL('#column', 'aboutDaisetsuzanGrade.html');\n      highlightTrail(null);\n      break;\n    case 'blog':\n      await loadURL('#column', 'blog.html');\n      highlightTrail(null);\n      break;\n    case 'aboutSugatami':\n    default:\n      // 404 = aboutSugatami\n      await loadURL('#column', 'aboutSugatami.html');\n      fitView('sugatami');\n      highlightTrail('sugatami');\n      break;\n  }\n}\n\nexport function pushStateAndNav(pageName) {\n  console.dir('pushStateAndNav');\n  window.history.pushState({ page: pageName }, null, '#/' + pageName);\n  doNav(pageName);\n}\n\n//クリックイベント関数の簡略化\n//javascript使っていたり　JQuery使っていたり分かりづらい\n//統一すべき\nfunction onClick(id, callback) {\n  document.getElementById(id).addEventListener('click', callback);\n}\n//各ボタンの処理\nonClick('aboutDaisetsuzan', function () {\n  pushStateAndNav('aboutDaisetsuzan');\n});\n\nonClick('aboutSugatami', function () {\n  pushStateAndNav('aboutSugatami');\n});\n\nonClick('aboutTrailToPeak', function () {\n  pushStateAndNav('aboutTrailToPeak');\n});\n\nonClick('about6hLoop', function () {\n  pushStateAndNav('about6hLoop');\n});\n\nonClick('info', function () {\n  pushStateAndNav('info');\n  // $(\"html,body\").animate({scrollTop:position},600);\n});\n\nonClick('aboutDaisetsuzanGrade', function () {\n  pushStateAndNav('aboutDaisetsuzanGrade');\n});\n\nonClick('blog', function () {\n  pushStateAndNav('blog');\n});\n\nconst navElements = document.querySelectorAll('.navbar-burger,.navbar-menu');\n\nfunction toggleNavBarClass() {\n  for (let element of navElements) {\n    element.classList.toggle('is-active');\n  }\n}\n\nfor (let element of navElements) {\n  // navElementsは本当のArrayじゃないから、for (... of ...)のみ使える\n  element.addEventListener('click', toggleNavBarClass);\n}\n\nwindow.onpopstate = function () {\n  const page = history.state !== null ? history.state.page : null;\n  console.dir('onpopstate  state:' + page);\n  doNav(page);\n};\n\ndoNav(document.location.hash.substring(2));\n"],"names":["loadURL","selector","url","timer","setTimeout","loaderStart","Promise","resolve","reject","$","load","_","status","xhr","clearTimeout","errMsg","statusText","updateLoader","Error","loaderElement","document","getElementById","loaderBox","querySelector","loaderMessage","loaderProgress","newState","msg","console","log","innerText","style","display","classList","remove","add","innerHTML","hasLoaded","fitView","view","AsahidakeMap","highlightTrail","trail","async","doNav","target","pushStateAndNav","pageName","dir","window","history","pushState","page","onClick","id","callback","addEventListener","undefined","navElements","querySelectorAll","toggleNavBarClass","element","toggle","onpopstate","state","location","hash","substring"],"mappings":"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"}